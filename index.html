<html lang=ar><head><script>var gk_isXlsx=!1,gk_xlsxFileLookup={},gk_fileData={};function filledCell(e){return""!==e&&null!=e}function loadFileData(e){if(gk_isXlsx&&gk_xlsxFileLookup[e])try{var l=XLSX.read(gk_fileData[e],{type:"base64"}),t=l.SheetNames[0],i=l.Sheets[t],a=XLSX.utils.sheet_to_json(i,{header:1,blankrows:!1,defval:""}).filter((e=>e.some(filledCell))),r=a.findIndex(((e,l)=>e.filter(filledCell).length>=a[l+1]?.filter(filledCell).length));(-1===r||r>25)&&(r=0);var s=XLSX.utils.aoa_to_sheet(a.slice(r));return s=XLSX.utils.sheet_to_csv(s,{header:1})}catch(e){return console.error(e),""}return gk_fileData[e]||""}</script>
<script>document.addEventListener("contextmenu",(e=>e.preventDefault())),document.addEventListener("keydown",(e=>{!e.ctrlKey||"u"!==e.key&&"U"!==e.key||e.preventDefault(),e.ctrlKey&&e.shiftKey&&("I"===e.key||"C"===e.key||"J"===e.key)&&e.preventDefault(),123===e.keyCode&&e.preventDefault()})),setTimeout((()=>{setInterval((()=>{(function(){const e=performance.now(),n=performance.now()-e;return n>300&&(console.log("DevTools detected: Timing difference = "+n+"ms"),!0)})()&&(document.body.innerHTML="",window.location.href="about:blank")}),500)}),3e3),setInterval((()=>{window.chrome&&chrome.runtime&&chrome.runtime.sendMessage&&(document.body.innerHTML="",window.location.href="about:blank")}),2e3),window.addEventListener("resize",(function(){(window.outerHeight-window.innerHeight>400||window.outerWidth-window.innerWidth>400)&&(document.body.innerHTML="",window.location.href="about:blank")}))</script>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>KingSignals Pro</title>
<script src=https://cdn.tailwindcss.com></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&amp;family=Cairo:wght@400;700&amp;display=swap" rel=stylesheet>
<script>tailwind.config={theme:{extend:{colors:{primary:"#1E3A8A",accent:"#00FF00",danger:"#F87171",success:"#34D399"},animation:{glow:"glow 0.8s ease-in-out infinite alternate","fade-in":"fadeIn 0.5s ease-out",pulse:"pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite","slide-in":"slideIn 0.3s ease-out",dropdown:"dropdown 0.3s ease-out"},keyframes:{glow:{"0%":{boxShadow:"0 0 8px rgba(0, 255, 0, 0.6), inset 0 0 8px rgba(0, 255, 0, 0.6)"},"100%":{boxShadow:"0 0 30px rgba(0, 255, 0, 0.9), inset 0 0 30px rgba(0, 255, 0, 0.9)"}},fadeIn:{"0%":{opacity:"0",transform:"translateY(20px)"},"100%":{opacity:"1",transform:"translateY(0)"}},pulse:{"0%, 100%":{opacity:"1"},"50%":{opacity:"0.5"}},slideIn:{"0%":{transform:"translateX(100%)"},"100%":{transform:"translateX(0)"}},dropdown:{"0%":{opacity:"0",transform:"scaleY(0)"},"100%":{opacity:"1",transform:"scaleY(1)"}}},fontFamily:{cairo:["Cairo","sans-serif"],orbitron:["Orbitron","sans-serif"]}}}}</script>
<style>body{background:#000;font-family:Cairo,sans-serif;min-height:100vh;overflow-y:auto;color:#fff;-webkit-user-select:none;user-select:none}#login-container{background:#000!important;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px}.glassmorphism{background:rgba(255,255,255,.03);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.08)}.gradient-text{background:linear-gradient(90deg,gold,#0f0);-webkit-background-clip:text;-webkit-text-fill-color:transparent}h1{font-family:Orbitron,sans-serif}.login-form{background:rgba(255,255,255,.05);backdrop-filter:blur(15px);border-radius:20px;padding:40px;width:100%;max-width:400px;box-shadow:0 0 50px rgba(0,255,0,.5);border:2px solid rgba(0,255,0,.3);position:relative;overflow:hidden;animation:fade-in .5s ease-out}.login-form::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(0,255,0,.2) 0,transparent 70%);animation:pulse 10s infinite;z-index:-1}.login-form input{width:100%;padding:14px;margin:10px 0;background:rgba(0,0,0,.9);border:1px solid rgba(0,255,0,.4);border-radius:10px;color:#fff;transition:border-color .3s,box-shadow .3s}.login-form input:focus{outline:0;border-color:#0f0;box-shadow:0 0 15px rgba(0,255,0,.7)}.login-form button{width:100%;padding:16px;margin:20px 0;background:linear-gradient(90deg,#0f0,gold);border:none;border-radius:10px;color:#000;font-weight:700;cursor:pointer;position:relative;overflow:hidden;transition:transform .3s}.login-form button:hover:not(:disabled){transform:scale(1.05);box-shadow:0 0 25px rgba(0,255,0,.8)}.login-form button:disabled{background:rgba(0,255,0,.3);cursor:not-allowed}.login-link{display:block;text-align:center;color:#34d399;margin-top:15px;transition:color .3s}.login-link:hover{color:gold}.error-message,.validation-message{color:#f87171;text-align:center;margin-top:5px;font-size:14px}.validation-message.valid{color:#34d399}.language-toggle-login{width:100%;padding:12px;margin:15px 0;background:rgba(0,255,0,.1);border:1px solid rgba(0,255,0,.3);border-radius:10px;color:#fff;text-align:center;cursor:pointer;transition:background .3s,box-shadow .3s}.language-toggle-login:hover{background:rgba(0,255,0,.3);box-shadow:0 0 15px rgba(0,255,0,.5)}.app-container{min-height:100vh;padding:20px;display:flex;flex-direction:column;align-items:center}.main-container{width:100%;max-width:400px;margin:0 auto}.widget-container{width:100%;max-width:317px;height:467px;border-radius:12px;overflow:hidden;position:relative;background:radial-gradient(circle,rgba(255,255,255,.1),#000);box-shadow:0 0 20px rgba(0,255,0,.3);margin:0 auto;animation:glow .8s ease-in-out infinite alternate}.widget-wrapper{width:100%;height:100%;border:1px solid rgba(0,255,0,.2)}.sidebar{position:fixed;top:0;right:-300px;width:300px;height:100%;background:rgba(0,0,0,.95);backdrop-filter:blur(10px);padding:20px;transition:transform .3s ease-out;z-index:1000;overflow-y:auto;box-shadow:-5px 0 15px rgba(0,255,0,.2)}.sidebar.open{transform:translateX(-300px);animation:slide-in .3s ease-out forwards}.hamburger{position:fixed;top:20px;right:20px;z-index:1100;padding:10px;background:rgba(0,0,0,.8);border-radius:8px;border:1px solid rgba(0,255,0,.3);cursor:pointer}.hamburger span{display:block;width:25px;height:3px;background:#0f0;margin:5px 0}.currency-dropdown{position:relative;width:100%;margin:10px 0}.currency-dropdown-toggle{display:flex;align-items:center;justify-content:space-between;padding:12px;background:linear-gradient(90deg,rgba(0,255,0,.1),rgba(255,215,0,.1));border:1px solid rgba(0,255,0,.4);border-radius:8px;color:#fff;cursor:pointer;transition:all .3s ease}.currency-dropdown-toggle:hover{background:linear-gradient(90deg,rgba(0,255,0,.3),rgba(255,215,0,.3));box-shadow:0 0 15px rgba(0,255,0,.7)}.currency-dropdown-menu{position:absolute;top:100%;left:0;right:0;background:rgba(0,0,0,.95);border:1px solid rgba(0,255,0,.4);border-radius:8px;max-height:300px;overflow-y:auto;transform-origin:top;animation:dropdown .3s ease-out;z-index:100;display:none}.currency-dropdown-menu.open{display:block}.currency-item{display:flex;align-items:center;justify-content:space-between;padding:10px 15px;color:#fff;cursor:pointer;transition:background .2s}.currency-item:hover{background:rgba(0,255,0,.2)}.currency-item.active{background:linear-gradient(90deg,rgba(0,255,0,.5),rgba(255,215,0,.5))}.favorite-star.favorited::after{content:'★';color:gold}.favorite-star:not(.favorited)::after{content:'☆';color:#fff}.auto-update-container{display:flex;gap:10px;margin-top:20px}.auto-update-input{width:60px;padding:5px;background:rgba(0,0,0,.8);border:1px solid rgba(0,255,0,.3);border-radius:5px;color:#fff;text-align:center}.sidebar-button{display:block;width:100%;padding:12px;margin:10px 0;background:linear-gradient(90deg,rgba(0,255,0,.1),rgba(255,215,0,.1));border:1px solid rgba(0,255,0,.3);border-radius:8px;color:#fff;text-align:center;cursor:pointer;transition:all .3s ease;position:relative;overflow:hidden}.sidebar-button::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(0,255,0,.3),transparent);transition:left .5s}.sidebar-button:hover::before{left:100%}.sidebar-button:hover{background:linear-gradient(90deg,rgba(0,255,0,.3),rgba(255,215,0,.3));box-shadow:0 0 15px rgba(0,255,0,.7);transform:translateX(5px)}.sidebar-button.active{background:linear-gradient(90deg,rgba(0,255,0,.5),rgba(255,215,0,.5));box-shadow:0 0 20px rgba(0,255,0,.9)}.user-details{display:none;background:rgba(0,0,0,.8);padding:10px;border-radius:5px;margin-top:10px}.user-details.open{display:block}.current-currency{margin-bottom:10px;font-weight:700;text-align:center;font-size:16px}.countdown-timer{margin-top:10px;font-weight:700;text-align:center;font-size:16px}.refresh-button{position:absolute;top:10px;left:10px;padding:8px;background:rgba(0,255,0,.1);border:1px solid rgba(0,255,0,.3);border-radius:5px;cursor:pointer;transition:background .3s,box-shadow .3s}.refresh-button:hover{background:rgba(0,255,0,.3);box-shadow:0 0 10px rgba(0,255,0,.5)}.usage-instructions{font-size:14px;text-align:center;margin:15px 0;line-height:1.6}.usage-instructions ul li{text-align:right}.green-text{color:#34d399;font-weight:700}.red-text{color:#f87171;font-weight:700}</style>
</head>
<body>
<div id=login-container class=login-container>
<h1 id=app-title class="text-5xl font-extrabold text-center gradient-text mb-10 animate-pulse">KingSignals Pro</h1>
<div class=login-form>
<input id=username placeholder="اسم المستخدم" required>
<p id=username-validation class=validation-message></p>
<input type=password id=password placeholder="كلمة المرور" required>
<p id=password-validation class=validation-message></p>
<button id=register-button class=register-button onclick=registerNewUser()>تسجيل مستخدم جديد</button>
<a id=login-link class=login-link href=# onclick=loginExistingUser()>لدي حساب بالفعل؟ تسجيل الدخول</a>
<button id=language-toggle-login class=language-toggle-login onclick=toggleLanguage()>Switch to English</button>
<p id=error-message class=error-message style=display:none></p>
</div>
</div>
<div id=app-container class=app-container style=display:none>
<div class=hamburger onclick=toggleSidebar()>
<span></span>
<span></span>
<span></span>
</div>
<div class=sidebar id=sidebar>
<h2 id=select-currency-title class="text-2xl font-bold text-center gradient-text mb-4">اختر العملة</h2>
<button id=user-details-toggle class=sidebar-button onclick=toggleUserDetails()>تفاصيل الاشتراك</button>
<div id=user-details class=user-details>
<p id=user-username></p>
<p id=user-subscription></p>
<p id=user-expiry></p>
</div>
<button id=favorites-toggle class=sidebar-button onclick=toggleFavorites()>عرض العملات المفضلة</button>
<div class=currency-dropdown>
<div class=currency-dropdown-toggle onclick=toggleDropdown()>
<span id=dropdown-selected>اختر عملة</span>
<span>▼</span>
</div>
<div id=currencyDropdown class=currency-dropdown-menu></div>
</div>
<div class=auto-update-container>
<input type=number id=updateInterval class=auto-update-input placeholder=ثوانٍ min=1 value=5>
<button id=autoUpdateButton class=sidebar-button onclick=toggleAutoUpdate()>تشغيل/إيقاف</button>
<button id=pauseResumeButton class=sidebar-button onclick=pauseResumeAutoUpdate() style=display:none>إيقاف مؤقت</button>
</div>
<button id=language-toggle class=sidebar-button onclick=toggleLanguage()>Switch to English</button>
</div>
<div class="main-container glassmorphism rounded-3xl p-8 flex flex-col items-center animate-glow">
<h1 id=app-title-main class="text-4xl font-extrabold text-center gradient-text mb-4">KingSignals Pro</h1>
<div id=current-currency class=current-currency>العملة الحالية: USD/JPY</div>
<div id=usage-instructions class=usage-instructions>
<p id=usage-title><strong>تعليمات الاستخدام</strong></p>
<p id=usage-select-duration>اختار مدة الصفقة التي تناسبك وتأكد من أن الإشارة تظهر بوضوح</p>
<p id=usage-rely-signal>اعتمد على الإشارة فقط عندما تكون</p>
<ul class="list-inside space-y-2 text-right">
<li id=usage-buy><span class=green-text>شراء قوي</span> عندما يظهر السهم باللون الأخضر (<span class=green-text>صعود</span>)</li>
<li id=usage-sell><span class=red-text>بيع قوي</span> عندما يظهر السهم باللون الأحمر (<span class=red-text>هبوط</span>)</li>
</ul>
<p id=usage-entry-point>الالتزام بفتح الصفقة عند نقطة الدخول لضمان أفضل نتائج</p>
</div>
<div class=widget-container>
<div class=widget-wrapper>
<iframe id=investingWidget src="https://ssltsw.investing.com?notChosenTab=%230d7ffa&amp;borderColor=%23ff0f0f&amp;dateFont=%23637a11&amp;lang=1&amp;forex=3&amp;commodities=8830,8836,8831,8849,8833,8862,8832&amp;indices=175,166,172,27,179,170,174&amp;stocks=345,346,347,348,349,350,352&amp;tabs=1,2,3,4" width=100% height=467 style=border:none;position:absolute;top:0;left:0;width:100%;height:100%></iframe>
<div style=position:absolute;top:-30px;left:0;width:100%;height:70px;background:#000;z-index:2></div>
<button id=refreshButton class=refresh-button onclick=refreshWidget()>⟳</button>
</div>
</div>
<div id=countdown-timer class=countdown-timer style=display:none></div>
<div class="text-sm text-white flex items-center justify-center mt-4">
Powered by <a href=https://t.me/KingTraDe28 target=_blank class="text-yellow-400 ml-1 hover:text-[#FFD700]">KING TRADING</a>
</div>
</div>
</div>
<script>var gk_isXlsx=!1,gk_xlsxFileLookup={},gk_fileData={};function filledCell(e){return""!==e&&null!=e}function loadFileData(e){if(gk_isXlsx&&gk_xlsxFileLookup[e])try{var t=XLSX.read(gk_fileData[e],{type:"base64"}),s=t.SheetNames[0],n=t.Sheets[s],r=XLSX.utils.sheet_to_json(n,{header:1,blankrows:!1,defval:""}).filter((e=>e.some(filledCell))),a=r.findIndex(((e,t)=>e.filter(filledCell).length>=r[t+1]?.filter(filledCell).length));(-1===a||a>25)&&(a=0);var o=XLSX.utils.aoa_to_sheet(r.slice(a));return o=XLSX.utils.sheet_to_csv(o,{header:1})}catch(e){return console.error(e),""}return gk_fileData[e]||""}const TELEGRAM_BOT_TOKEN="7598383386:AAGqY5nBEuLzclvgCffQ1Q8AWL553DvOlV4",TELEGRAM_CHAT_ID="2018615159",TELEGRAM_API_URL=`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}`,currencyMap={3:"USD/JPY",1:"EUR/USD",2:"GBP/USD",5:"AUD/USD",7:"USD/CAD",9:"EUR/JPY",10:"EUR/CHF",47:"AUD/CAD",6:"EUR/GBP",51:"CAD/JPY",48:"AUD/CHF",49:"AUD/JPY",4:"USD/CHF",12:"GBP/CHF",16:"EUR/CAD"},sortedCurrencies=Object.entries(currencyMap).sort(((e,t)=>e[1].localeCompare(t[1])));let currentIndex=0,intervalId=null,isAutoUpdating=!1,isPaused=!1,favorites=JSON.parse(localStorage.getItem("favorites"))||[],showFavorites=!1,countdownInterval=null,currentCurrencyId="3",isEnglish=!1,userSession=JSON.parse(localStorage.getItem("userSession"))||null,users=JSON.parse(localStorage.getItem("users"))||{},blockedUsers=JSON.parse(localStorage.getItem("blockedUsers"))||{},pendingRegistrations=JSON.parse(localStorage.getItem("pendingRegistrations"))||{},processedMessages=JSON.parse(localStorage.getItem("processedMessages"))||{},isRegistering=!1,registrationTimeout=null,isDropdownOpen=!1;const translations={ar:{selectCurrency:"اختر العملة",appSubject:"KingSignals Pro",usageTitle:"تعليمات الاستخدام",usageSelectDuration:"اختار مدة الصفقة التي تناسبك وتأكد من أن الإشارة تظهر بوضوح",usageRelySignal:"اعتمد على الإشارة فقط عندما تكون",usageBuy:'<span class="green-text">شراء قوي</span> عندما يظهر السهم باللون الأخضر (<span class="green-text">صعود</span>)',usageSell:'<span class="red-text">بيع قوي</span> عندما يظهر السهم باللون الأحمر (<span class="red-text">هبوط</span>)',usageEntryPoint:"الالتزام بفتح الصفقة عند نقطة الدخول لضمان أفضل نتائج",autoUpdate:"تشغيل/إيقاف",pauseResume:"إيقاف مؤقت",resume:"استئناف",languageToggle:"Switch to English",favoritesToggle:"عرض العملات المفضلة",allCurrencies:"عرض جميع العملات",currentCurrency:"العملة الحالية",userDetailsToggle:"تفاصيل الاشتراك",userUsername:"اسم المستخدم",userSubscription:"مدة الاشتراك",userExpiry:"تاريخ الانتهاء",day:"يوم",days:"أيام",hour:"ساعة",hours:"ساعات",minute:"دقيقة",minutes:"دقائق",accountBlocked:"حسابك تم حظره",usernamePlaceholder:"اسم المستخدم",passwordPlaceholder:"كلمة المرور",registerButton:"تسجيل مستخدم جديد",loginLink:"لدي حساب بالفعل؟ تسجيل الدخول",usernameTooShort:"اسم المستخدم يجب أن يكون 4 أحرف أو أكثر",usernameValid:"اسم المستخدم صالح",passwordTooShort:"كلمة المرور يجب أن تكون 8 أحرف أو أكثر",passwordValid:"كلمة المرور صالحة",enterUsernamePassword:"يرجى إدخال اسم المستخدم وكلمة المرور",incorrectCredentials:"اسم المستخدم أو كلمة المرور غير صحيحة",subscriptionExpired:"انتهى الاشتراك. يرجى التسجيل مرة أخرى.",registrationInProgress:"جاري معالجة طلب التسجيل.",registrationSent:"تم إرسال طلب التسجيل. في انتظار الموافقة...",registrationTimeout:"انتهت مهلة الطلب. حاول مرة أخرى.",registrationFailed:"فشل إرسال الطلب. تحقق من الاتصال.",registrationDenied:"تم رفض التسجيل.",usernameTaken:"اسم المستخدم مستخدم بالفعل."},en:{selectCurrency:"Select Currency",appSubject:"KingSignals Pro",usageTitle:"Usage Instructions",usageSelectDuration:"Choose the trade duration that suits you and ensure the signal is clear",usageRelySignal:"Rely on the signal only when it is",usageBuy:'<span class="green-text">Strong Buy</span> when the arrow is green (<span class="green-text">Uptrend</span>)',usageSell:'<span class="red-text">Strong Sell</span> when the arrow is red (<span class="red-text">Downtrend</span>)',usageEntryPoint:"Stick to opening the trade at the entry point for best results",autoUpdate:"Start/Stop",pauseResume:"Pause",resume:"Resume",languageToggle:"Switch to Arabic",favoritesToggle:"Show Favorite Currencies",allCurrencies:"Show All Currencies",currentCurrency:"Current Currency",userDetailsToggle:"Subscription Details",userUsername:"Username",userSubscription:"Subscription Duration",userExpiry:"Expiry Date",day:"day",days:"days",hour:"hour",hours:"hours",minute:"minute",minutes:"minutes",accountBlocked:"Your account has been blocked",usernamePlaceholder:"Username",passwordPlaceholder:"Password",registerButton:"Register New User",loginLink:"Already have an account? Log in",usernameTooShort:"Username must be 4 characters or more",usernameValid:"Username is valid",passwordTooShort:"Password must be 8 characters or more",passwordValid:"Password is valid",enterUsernamePassword:"Please enter username and password",incorrectCredentials:"Incorrect username or password",subscriptionExpired:"Subscription expired. Please register again.",registrationInProgress:"Registration request in progress.",registrationSent:"Registration request sent. Awaiting approval...",registrationTimeout:"Registration request timed out. Try again.",registrationFailed:"Failed to send request. Check connection.",registrationDenied:"Registration denied.",usernameTaken:"Username is already taken."}};async function initBotCommands(){try{await fetch(`${TELEGRAM_API_URL}/setMyCommands`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({commands:[{command:"/start",description:"بدء البوت"},{command:"/block",description:"حظر مستخدم"},{command:"/stats",description:"عرض إحصائيات البوت"}]})})}catch(e){console.error("Failed to set bot commands:",e)}}function isValidUsername(e){return e.trim().length>=4}function isValidPassword(e){return e.length>=8}function updateValidationFeedback(){const e=document.getElementById("username").value,t=document.getElementById("password").value,s=isEnglish?"en":"ar",n=document.getElementById("username-validation"),r=document.getElementById("password-validation");n.textContent=e&&isValidUsername(e)?translations[s].usernameValid:translations[s].usernameTooShort,n.classList.toggle("valid",e&&isValidUsername(e)),r.textContent=t&&isValidPassword(t)?translations[s].passwordValid:translations[s].passwordTooShort,r.classList.toggle("valid",t&&isValidPassword(t))}function checkSession(){!userSession||userSession.expiresAt<Date.now()||blockedUsers[userSession.username.toLowerCase()]?(blockedUsers[userSession?.username.toLowerCase()]&&showError(translations[isEnglish?"en":"ar"].accountBlocked),localStorage.removeItem("userSession"),userSession=null,showLogin()):(showApp(),generateCurrencyDropdown(),updateWidget("3"),startSessionTimer(),updateUserDetails())}function startSessionTimer(){setInterval((()=>{userSession&&(userSession.expiresAt<Date.now()?(alert(translations[isEnglish?"en":"ar"].subscriptionExpired),localStorage.removeItem("userSession"),userSession=null,showLogin()):blockedUsers[userSession.username.toLowerCase()]?(alert(translations[isEnglish?"en":"ar"].accountBlocked),localStorage.removeItem("userSession"),userSession=null,showError(translations[isEnglish?"en":"ar"].accountBlocked),showLogin()):updateUserDetails())}),1e3)}function updateUserDetails(){if(!userSession)return;const e=isEnglish?"en":"ar",t=new Date(userSession.expiresAt).toLocaleString(isEnglish?"en-US":"ar-EG"),s=Math.max(0,userSession.expiresAt-Date.now()),n=Math.floor(s/864e5),r=Math.floor(s%864e5/36e5),a=Math.floor(s%36e5/6e4);let o=n>0?`${n} ${1===n?translations[e].day:translations[e].days}`:r>0?`${r} ${1===r?translations[e].hour:translations[e].hours}`:`${a} ${1===a?translations[e].minute:translations[e].minutes}`;document.getElementById("user-username").textContent=`${translations[e].userUsername}: ${userSession.username}`,document.getElementById("user-subscription").textContent=`${translations[e].userSubscription}: ${o}`,document.getElementById("user-expiry").textContent=`${translations[e].userExpiry}: ${t}`}function toggleUserDetails(){document.getElementById("user-details").classList.toggle("open")}async function loginExistingUser(){const e=document.getElementById("username").value.trim(),t=document.getElementById("password").value.trim(),s=isEnglish?"en":"ar";if(!e||!t)return showError(translations[s].enterUsernamePassword);if(!isValidUsername(e))return showError(translations[s].usernameTooShort);if(!isValidPassword(t))return showError(translations[s].passwordTooShort);if(blockedUsers[e.toLowerCase()])return showError(translations[s].accountBlocked);const n=sha256(t),r=users[e.toLowerCase()];return r&&r.hashedPassword===n?!userSession||userSession.expiresAt<Date.now()?showError(translations[s].subscriptionExpired):(showApp(),generateCurrencyDropdown(),updateWidget("3"),startSessionTimer(),updateUserDetails(),void(document.getElementById("error-message").style.display="none")):showError(translations[s].incorrectCredentials)}async function registerNewUser(){if(isRegistering)return showError(translations[isEnglish?"en":"ar"].registrationInProgress);const e=document.getElementById("username").value.trim(),t=document.getElementById("password").value.trim(),s=document.getElementById("register-button"),n=isEnglish?"en":"ar";if(!e||!t)return showError(translations[n].enterUsernamePassword);if(!isValidUsername(e))return showError(translations[n].usernameTooShort);if(!isValidPassword(t))return showError(translations[n].passwordTooShort);if(users[e.toLowerCase()])return showError(translations[n].usernameTaken);if(blockedUsers[e.toLowerCase()])return showError(translations[n].accountBlocked);isRegistering=!0,s.disabled=!0,s.textContent=isEnglish?"Sending...":"جاري الإرسال...";const r=sha256(t),a=`طلب تسجيل جديد:\nاسم المستخدم: ${e}`;try{await sendTelegramMessage(a,[[{text:`موافق ${e}`,callback_data:`approve_${e}`}],[{text:`رفض ${e}`,callback_data:`deny_${e}`}]]),showSuccess(translations[n].registrationSent),pendingRegistrations[e.toLowerCase()]={username:e,hashedPassword:r},localStorage.setItem("pendingRegistrations",JSON.stringify(pendingRegistrations)),registrationTimeout=setTimeout((()=>{resetRegistrationState(),delete pendingRegistrations[e.toLowerCase()],localStorage.setItem("pendingRegistrations",JSON.stringify(pendingRegistrations)),showError(translations[n].registrationTimeout)}),3e5)}catch(e){resetRegistrationState(),showError(translations[n].registrationFailed)}}function resetRegistrationState(){isRegistering=!1;const e=document.getElementById("register-button");e.disabled=!1,e.textContent=translations[isEnglish?"en":"ar"].registerButton,registrationTimeout&&(clearTimeout(registrationTimeout),registrationTimeout=null)}async function sendTelegramMessage(e,t=null){const s={chat_id:"2018615159",text:e,parse_mode:"Markdown"};t&&(s.reply_markup={inline_keyboard:t});const n=await fetch(`${TELEGRAM_API_URL}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await n.json();if(!r.ok)throw new Error(`Telegram API error: ${r.description}`);return r}async function pollTelegramMessages(){let e=parseInt(localStorage.getItem("lastUpdateId"))||0;setInterval((async()=>{try{const t=await fetch(`${TELEGRAM_API_URL}/getUpdates?offset=${e+1}&timeout=30`),s=await t.json();if(!s.ok)return;for(const t of s.result)if(e=t.update_id,localStorage.setItem("lastUpdateId",e),t.callback_query){const e=t.callback_query.data,s=t.callback_query.message.message_id;if(processedMessages[s])continue;processedMessages[s]=!0,localStorage.setItem("processedMessages",JSON.stringify(processedMessages));const n=e.match(/^approve_(.+)$/),r=e.match(/^deny_(.+)$/),a=e.match(/^set_duration_(.+)$/);if(n){const e=n[1].toLowerCase();pendingRegistrations[e]&&(pendingRegistrations[e].awaitingDuration=!0,localStorage.setItem("pendingRegistrations",JSON.stringify(pendingRegistrations)),await sendTelegramMessage(`اضغط لتحديد مدة الاشتراك لـ ${e}:`,[[{text:"تحديد مدة الاشتراك",callback_data:`set_duration_${e}`}]]))}else if(r){const e=r[1].toLowerCase();pendingRegistrations[e]&&(resetRegistrationState(),delete pendingRegistrations[e],localStorage.setItem("pendingRegistrations",JSON.stringify(pendingRegistrations)),showError(translations[isEnglish?"en":"ar"].registrationDenied))}else if(a){const e=a[1].toLowerCase();pendingRegistrations[e]&&(await sendTelegramMessage(`أدخل مدة الاشتراك لـ ${e} (مثال: 3m للدقائق، 3h للساعات، 3d للأيام):`),pendingRegistrations[e].awaitingDurationInput=!0,localStorage.setItem("pendingRegistrations",JSON.stringify(pendingRegistrations)))}}else if(t.message&&"2018615159"==t.message.chat.id){const e=t.message.message_id,s=t.message.text?.trim()||"";if(processedMessages[e])continue;if(processedMessages[e]=!0,localStorage.setItem("processedMessages",JSON.stringify(processedMessages)),"/stats"===s){const e=Object.keys(users).length,t=Object.keys(blockedUsers).length,s=Object.values(users).filter((e=>!blockedUsers[e.username?.toLowerCase()])).length;await sendTelegramMessage(`📊 إحصائيات البوت:\nإجمالي المستخدمين: ${e}\nالمستخدمين المحظورين: ${t}\nالمستخدمين النشطين: ${s}`)}else if(s.startsWith("/block")){const e=s.split(" ")[1]?.trim();e?users[e.toLowerCase()]||blockedUsers[e.toLowerCase()]?(blockedUsers[e.toLowerCase()]=!0,localStorage.setItem("blockedUsers",JSON.stringify(blockedUsers)),await sendTelegramMessage(`تم حظر ${e} بنجاح.`),userSession&&userSession.username.toLowerCase()===e.toLowerCase()&&(alert(translations[isEnglish?"en":"ar"].accountBlocked),userSession=null,localStorage.removeItem("userSession"),showError(translations[isEnglish?"en":"ar"].accountBlocked),showLogin())):await sendTelegramMessage(`اسم المستخدم ${e} غير موجود.`):await sendTelegramMessage("أدخل اسم المستخدم: /block <username>")}else{const e=s.match(/^(\d+)([mhd])$/);if(e){const t=Object.keys(pendingRegistrations).find((e=>pendingRegistrations[e].awaitingDurationInput));if(t){const s=parseInt(e[1]),n=e[2].toLowerCase();let r,a;"d"===n?(r=24*s*60*60*1e3,a=`${s} ${1===s?translations[isEnglish?"en":"ar"].day:translations[isEnglish?"en":"ar"].days}`):"h"===n?(r=60*s*60*1e3,a=`${s} ${1===s?translations[isEnglish?"en":"ar"].hour:translations[isEnglish?"en":"ar"].hours}`):(r=60*s*1e3,a=`${s} ${1===s?translations[isEnglish?"en":"ar"].minute:translations[isEnglish?"en":"ar"].minutes}`);const{username:o,hashedPassword:i}=pendingRegistrations[t],l=Date.now()+r;userSession={username:o,expiresAt:l,favorites:[]},users[t]={hashedPassword:i,approved:!0},localStorage.setItem("users",JSON.stringify(users)),localStorage.setItem("userSession",JSON.stringify(userSession)),showApp(),generateCurrencyDropdown(),updateWidget("3"),startSessionTimer(),updateUserDetails(),await sendTelegramMessage(`تم تفعيل اشتراك ${o} لمدة ${a}.`),resetRegistrationState(),delete pendingRegistrations[t],localStorage.setItem("pendingRegistrations",JSON.stringify(pendingRegistrations))}}}}}catch(e){console.error("Polling error:",e)}}),2e3)}function showError(e){const t=document.getElementById("error-message");t.textContent=e,t.style.display="block",t.style.color="#F87171"}function showSuccess(e){const t=document.getElementById("error-message");t.textContent=e,t.style.display="block",t.style.color="#34D399"}function showLogin(){document.getElementById("login-container").style.display="flex",document.getElementById("app-container").style.display="none",resetRegistrationState(),updateLoginInterface()}function showApp(){document.getElementById("login-container").style.display="none",document.getElementById("app-container").style.display="flex"}function generateCurrencyDropdown(){const e=document.getElementById("currencyDropdown");e.innerHTML="";(showFavorites?sortedCurrencies.filter((([e])=>favorites.includes(e))):sortedCurrencies).forEach((([t,s])=>{const n=document.createElement("div");n.className="currency-item "+(currentCurrencyId===t?"active":""),n.setAttribute("data-currency-id",t),n.innerHTML=`<span>${s}</span><span class="favorite-star ${favorites.includes(t)?"favorited":""}"></span>`,n.onclick=()=>{isAutoUpdating&&stopAutoUpdate(),updateWidget(t),document.getElementById("dropdown-selected").textContent=s,toggleDropdown()},n.querySelector(".favorite-star").onclick=e=>{e.stopPropagation(),toggleFavorite(t),generateCurrencyDropdown()},e.appendChild(n)})),document.getElementById("dropdown-selected").textContent=currencyMap[currentCurrencyId]||translations[isEnglish?"en":"ar"].selectCurrency}function toggleDropdown(){isDropdownOpen=!isDropdownOpen,document.getElementById("currencyDropdown").classList.toggle("open",isDropdownOpen)}function toggleSidebar(){document.getElementById("sidebar").classList.toggle("open"),document.getElementById("sidebar").classList.contains("open")||(isDropdownOpen=!1,document.getElementById("currencyDropdown").classList.remove("open"))}function updateWidget(e,t=!1){document.getElementById("investingWidget").src=`https://ssltsw.investing.com?notChosenTab=%230d7ffa&borderColor=%23ff0f0f&dateFont=%23637a11&lang=1&forex=${e}&commodities=8830,8836,8831,8849,8833,8862,8832&indices=175,166,172,27,179,170,174&stocks=345,346,347,348,349,350,352&tabs=1,2,3,4`,currentCurrencyId=e,document.querySelectorAll(".currency-item").forEach((e=>e.classList.remove("active")));const s=document.querySelector(`.currency-item[data-currency-id="${e}"]`);s&&s.classList.add("active"),t||toggleSidebar(),document.getElementById("current-currency").textContent=`${translations[isEnglish?"en":"ar"].currentCurrency}: ${currencyMap[e]}`,document.getElementById("dropdown-selected").textContent=currencyMap[e]}function refreshWidget(){updateWidget(currentCurrencyId)}function toggleAutoUpdate(){const e=document.getElementById("updateInterval"),t=parseInt(e.value);isNaN(t)||t<1?alert(translations[isEnglish?"en":"ar"].enterUsernamePassword):isAutoUpdating?stopAutoUpdate():(isAutoUpdating=!0,document.getElementById("autoUpdateButton").classList.add("active"),document.getElementById("pauseResumeButton").style.display="block",document.getElementById("pauseResumeButton").textContent=translations[isEnglish?"en":"ar"].pauseResume,currentIndex=0,updateWidget(getCurrentCurrencies()[currentIndex][0],!0),startCountdown(t),intervalId=setInterval((()=>{isPaused||(currentIndex=(currentIndex+1)%getCurrentCurrencies().length,updateWidget(getCurrentCurrencies()[currentIndex][0],!0),startCountdown(t))}),1e3*t))}function pauseResumeAutoUpdate(){const e=document.getElementById("pauseResumeButton");if(isPaused=!isPaused,e.textContent=isPaused?translations[isEnglish?"en":"ar"].resume:translations[isEnglish?"en":"ar"].pauseResume,isPaused)clearInterval(countdownInterval),document.getElementById("countdown-timer").style.display="none";else{startCountdown(parseInt(document.getElementById("updateInterval").value))}}function stopAutoUpdate(){intervalId&&(clearInterval(intervalId),clearInterval(countdownInterval),intervalId=null,isAutoUpdating=!1,isPaused=!1,document.getElementById("autoUpdateButton").classList.remove("active"),document.getElementById("pauseResumeButton").style.display="none",document.getElementById("countdown-timer").style.display="none")}function startCountdown(e){clearInterval(countdownInterval);let t=e;const s=document.getElementById("countdown-timer");s.style.display="block",s.textContent=`${isEnglish?"Next update in":"الانتقال بعد"}: ${t} ${isEnglish?"seconds":"ثوانٍ"}`,countdownInterval=setInterval((()=>{t--,t<=0&&(t=e),s.textContent=`${isEnglish?"Next update in":"الانتقال بعد"}: ${t} ${isEnglish?"seconds":"ثوانٍ"}`}),1e3)}function toggleFavorite(e){favorites=favorites.includes(e)?favorites.filter((t=>t!==e)):[...favorites,e],localStorage.setItem("favorites",JSON.stringify(favorites))}function toggleFavorites(){showFavorites=!showFavorites,document.getElementById("favorites-toggle").textContent=showFavorites?translations[isEnglish?"en":"ar"].allCurrencies:translations[isEnglish?"en":"ar"].favoritesToggle,generateCurrencyDropdown()}function getCurrentCurrencies(){return showFavorites&&favorites.length>0?sortedCurrencies.filter((([e])=>favorites.includes(e))):sortedCurrencies}function toggleLanguage(){isEnglish=!isEnglish,updateInterface()}function updateInterface(){const e=isEnglish?"en":"ar";document.getElementById("select-currency-title").textContent=translations[e].selectCurrency,document.getElementById("app-title").textContent=translations[e].appSubject,document.getElementById("app-title-main").textContent=translations[e].appSubject,document.getElementById("usage-title").innerHTML=`<strong>${translations[e].usageTitle}</strong>`,document.getElementById("usage-select-duration").textContent=translations[e].usageSelectDuration,document.getElementById("usage-rely-signal").textContent=translations[e].usageRelySignal,document.getElementById("usage-buy").innerHTML=translations[e].usageBuy,document.getElementById("usage-sell").innerHTML=translations[e].usageSell,document.getElementById("usage-entry-point").textContent=translations[e].usageEntryPoint,document.getElementById("autoUpdateButton").textContent=translations[e].autoUpdate,document.getElementById("pauseResumeButton").textContent=isPaused?translations[e].resume:translations[e].pauseResume,document.getElementById("language-toggle").textContent=translations[e].languageToggle,document.getElementById("language-toggle-login").textContent=translations[e].languageToggle,document.getElementById("favorites-toggle").textContent=showFavorites?translations[e].allCurrencies:translations[e].favoritesToggle,document.getElementById("user-details-toggle").textContent=translations[e].userDetailsToggle,document.getElementById("current-currency").textContent=`${translations[e].currentCurrency}: ${currencyMap[currentCurrencyId]}`,document.getElementById("username").placeholder=translations[e].usernamePlaceholder,document.getElementById("password").placeholder=translations[e].passwordPlaceholder,document.getElementById("register-button").textContent=translations[e].registerButton,document.getElementById("login-link").textContent=translations[e].loginLink,updateUserDetails(),updateValidationFeedback(),document.documentElement.setAttribute("dir",isEnglish?"ltr":"rtl"),generateCurrencyDropdown()}function updateLoginInterface(){updateValidationFeedback()}document.addEventListener("contextmenu",(e=>e.preventDefault())),document.addEventListener("keydown",(e=>{(123===e.keyCode||e.ctrlKey&&e.shiftKey&&(73===e.keyCode||74===e.keyCode||67===e.keyCode)||e.ctrlKey&&85===e.keyCode)&&e.preventDefault()})),window.onload=function(){isEnglish=!navigator.language.includes("ar"),updateInterface(),checkSession(),document.getElementById("username").addEventListener("input",updateValidationFeedback),document.getElementById("password").addEventListener("input",updateValidationFeedback),pollTelegramMessages(),initBotCommands(),updateValidationFeedback()},document.addEventListener("click",(e=>{const t=document.getElementById("sidebar"),s=document.querySelector(".hamburger"),n=document.getElementById("currencyDropdown"),r=document.querySelector(".currency-dropdown-toggle");t.contains(e.target)||s.contains(e.target)?n.contains(e.target)||r.contains(e.target)||(isDropdownOpen=!1,n.classList.remove("open")):(t.classList.remove("open"),isDropdownOpen=!1,n.classList.remove("open"))}))</script>
</body></html>