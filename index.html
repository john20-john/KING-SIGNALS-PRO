<html lang=ar dir=rtl><head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>KingSignals Pro</title>
<script src=https://cdn.tailwindcss.com></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&amp;family=Cairo:wght@400;700&amp;display=swap" rel=stylesheet>
<script>tailwind.config={theme:{extend:{colors:{primary:"#1E3A8A",accent:"#00FF00",danger:"#F87171",success:"#34D399",modalBg:"rgba(0, 0, 0, 0.85)",modalContentBg:"rgba(10, 20, 30, 0.95)"},animation:{glow:"glow 0.8s ease-in-out infinite alternate","fade-in":"fadeIn 0.5s ease-out",pulse:"pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite","slide-in":"slideIn 0.3s ease-out",dropdown:"dropdown 0.3s ease-out forwards","modal-fade-in":"modalFadeIn 0.3s ease-out"},keyframes:{glow:{"0%":{boxShadow:"0 0 8px rgba(0, 255, 0, 0.6), inset 0 0 8px rgba(0, 255, 0, 0.6)"},"100%":{boxShadow:"0 0 30px rgba(0, 255, 0, 0.9), inset 0 0 30px rgba(0, 255, 0, 0.9)"}},fadeIn:{"0%":{opacity:"0",transform:"translateY(20px)"},"100%":{opacity:"1",transform:"translateY(0)"}},pulse:{"0%, 100%":{opacity:"1"},"50%":{opacity:"0.5"}},slideIn:{"0%":{transform:"translateX(100%)"},"100%":{transform:"translateX(0)"}},dropdown:{"0%":{opacity:"0",transform:"scaleY(0.95) translateY(-10px)"},"100%":{opacity:"1",transform:"scaleY(1) translateY(0)"}},modalFadeIn:{"0%":{opacity:"0",transform:"scale(0.95)"},"100%":{opacity:"1",transform:"scale(1)"}}},fontFamily:{cairo:["Cairo","sans-serif"],orbitron:["Orbitron","sans-serif"]}}}}</script>
<style>body{background:#000;font-family:Cairo,sans-serif;min-height:100vh;overflow-y:auto;color:#fff;-webkit-user-select:none;user-select:none}#login-container{background:#000!important;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px}.glassmorphism{background:rgba(255,255,255,.03);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.08)}.gradient-text{background:linear-gradient(90deg,gold,#0f0);-webkit-background-clip:text;-webkit-text-fill-color:transparent}h1{font-family:Orbitron,sans-serif}.login-form{background:rgba(255,255,255,.05);backdrop-filter:blur(15px);border-radius:20px;padding:40px;width:100%;max-width:400px;box-shadow:0 0 50px rgba(0,255,0,.5);border:2px solid rgba(0,255,0,.3);position:relative;overflow:hidden;animation:fade-in .5s ease-out}.login-form::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(0,255,0,.2) 0,transparent 70%);animation:pulse 10s infinite;z-index:-1}.login-form input{width:100%;padding:14px;margin:10px 0;background:rgba(0,0,0,.9);border:1px solid rgba(0,255,0,.4);border-radius:10px;color:#fff;transition:border-color .3s,box-shadow .3s}.login-form input:focus{outline:0;border-color:#0f0;box-shadow:0 0 15px rgba(0,255,0,.7)}.login-form button{width:100%;padding:16px;margin:20px 0;background:linear-gradient(90deg,#0f0,gold);border:none;border-radius:10px;color:#000;font-weight:700;cursor:pointer;position:relative;overflow:hidden;transition:transform .3s,box-shadow .3s}.login-form button:hover:not(:disabled){transform:scale(1.05);box-shadow:0 0 25px rgba(0,255,0,.8)}.login-form button:disabled{background:rgba(0,255,0,.3);cursor:not-allowed;opacity:.7}.login-link{display:block;text-align:center;color:#34d399;margin-top:15px;transition:color .3s}.login-link:hover{color:gold}.error-message,.validation-message{color:#f87171;text-align:center;margin-top:5px;font-size:14px;min-height:20px}.validation-message.valid{color:#34d399}.language-toggle-login{width:100%;padding:12px;margin:15px 0;background:rgba(0,255,0,.1);border:1px solid rgba(0,255,0,.3);border-radius:10px;color:#fff;text-align:center;cursor:pointer;transition:background .3s,box-shadow .3s}.language-toggle-login:hover{background:rgba(0,255,0,.3);box-shadow:0 0 15px rgba(0,255,0,.5)}.app-container{min-height:100vh;padding:20px;display:flex;flex-direction:column;align-items:center}.main-container{width:100%;max-width:400px;margin:0 auto}.widget-container{width:100%;max-width:317px;height:467px;border-radius:12px;overflow:hidden;position:relative;background:radial-gradient(circle,rgba(255,255,255,.1),#000);box-shadow:0 0 20px rgba(0,255,0,.3);margin:20px auto;animation:glow .8s ease-in-out infinite alternate}.widget-wrapper{width:100%;height:100%;border:1px solid rgba(0,255,0,.2)}.sidebar{position:fixed;top:0;right:-300px;width:300px;height:100%;background:rgba(0,0,0,.95);backdrop-filter:blur(10px);padding:20px;transition:transform .3s ease-out;z-index:1000;overflow-y:auto;box-shadow:-5px 0 15px rgba(0,255,0,.2)}.sidebar.open{transform:translateX(-300px)}.hamburger{position:fixed;top:20px;right:20px;z-index:1100;padding:10px;background:rgba(0,0,0,.8);border-radius:8px;border:1px solid rgba(0,255,0,.3);cursor:pointer}.hamburger span{display:block;width:25px;height:3px;background:#0f0;margin:5px 0;transition:transform .3s,opacity .3s}.sidebar.open+.hamburger span:first-child{transform:translateY(8px) rotate(45deg)}.sidebar.open+.hamburger span:nth-child(2){opacity:0}.sidebar.open+.hamburger span:nth-child(3){transform:translateY(-8px) rotate(-45deg)}.currency-dropdown{position:relative;width:100%;margin:10px 0}.currency-dropdown-toggle{display:flex;align-items:center;justify-content:space-between;padding:12px;background:linear-gradient(90deg,rgba(0,255,0,.1),rgba(255,215,0,.1));border:1px solid rgba(0,255,0,.4);border-radius:8px;color:#fff;cursor:pointer;transition:all .3s ease}.currency-dropdown-toggle:hover{background:linear-gradient(90deg,rgba(0,255,0,.3),rgba(255,215,0,.3));box-shadow:0 0 15px rgba(0,255,0,.7)}.currency-dropdown-menu{position:absolute;top:100%;left:0;right:0;background:rgba(0,0,0,.98);border:1px solid rgba(0,255,0,.4);border-top:none;border-radius:0 0 8px 8px;max-height:300px;overflow-y:auto;transform-origin:top;z-index:100;display:none;animation:dropdown .3s ease-out forwards}.currency-dropdown-menu.open{display:block}.currency-item{display:flex;align-items:center;justify-content:space-between;padding:10px 15px;color:#fff;cursor:pointer;transition:background .2s}.currency-item:hover{background:rgba(0,255,0,.2)}.currency-item.active{background:linear-gradient(90deg,rgba(0,255,0,.5),rgba(255,215,0,.5));font-weight:700}.favorite-star{font-size:1.2em;line-height:1;margin-left:8px}.favorite-star.favorited::after{content:'★';color:gold}.favorite-star:not(.favorited)::after{content:'☆';color:#ccc}.auto-update-container{display:flex;gap:10px;margin-top:20px;align-items:center}.auto-update-input{width:60px;padding:8px;background:rgba(0,0,0,.8);border:1px solid rgba(0,255,0,.3);border-radius:5px;color:#fff;text-align:center}.sidebar-button{display:block;width:100%;padding:12px;margin:10px 0;background:linear-gradient(90deg,rgba(0,255,0,.1),rgba(255,215,0,.1));border:1px solid rgba(0,255,0,.3);border-radius:8px;color:#fff;text-align:center;cursor:pointer;transition:all .3s ease;position:relative;overflow:hidden}.sidebar-button::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(0,255,0,.3),transparent);transition:left .5s}.sidebar-button:hover::before{left:100%}.sidebar-button:hover{background:linear-gradient(90deg,rgba(0,255,0,.3),rgba(255,215,0,.3));box-shadow:0 0 15px rgba(0,255,0,.7);transform:translateX(5px)}.sidebar-button.active{background:linear-gradient(90deg,rgba(0,255,0,.5),rgba(255,215,0,.5));box-shadow:0 0 20px rgba(0,255,0,.9)}.user-details{display:none;background:rgba(0,0,0,.8);padding:15px;border-radius:8px;margin-top:10px;border:1px solid rgba(0,255,0,.2)}.user-details.open{display:block;animation:fadeIn .3s ease-out}.user-details p{margin-bottom:8px;font-size:.9rem}.user-details p:last-child{margin-bottom:0}.current-currency{margin-bottom:10px;font-weight:700;text-align:center;font-size:16px}.countdown-timer{margin-top:10px;font-weight:700;text-align:center;font-size:16px}.refresh-button{position:absolute;top:10px;left:10px;padding:8px;background:rgba(0,255,0,.1);border:1px solid rgba(0,255,0,.3);border-radius:5px;cursor:pointer;transition:background .3s,box-shadow .3s;z-index:10}.refresh-button:hover{background:rgba(0,255,0,.3);box-shadow:0 0 10px rgba(0,255,0,.5)}.usage-instructions{font-size:14px;text-align:center;margin:15px 0;line-height:1.6;padding:10px;background:rgba(255,255,255,.05);border-radius:8px}.usage-instructions ul{padding-right:20px}.usage-instructions ul li{text-align:right}.green-text{color:#34d399;font-weight:700}.red-text{color:#f87171;font-weight:700}.ai-insights-modal{position:fixed;top:0;left:0;width:100%;height:100%;background-color:var(--tw-bg-modalBg,rgba(0,0,0,.85));display:flex;align-items:center;justify-content:center;z-index:2000;opacity:0;visibility:hidden;transition:opacity .3s ease-out,visibility 0s linear .3s}.ai-insights-modal.open{opacity:1;visibility:visible;transition:opacity .3s ease-out,visibility 0s linear 0s}.ai-insights-modal-content{background-color:var(--tw-bg-modalContentBg,rgba(10,20,30,.95));padding:20px;border-radius:12px;border:1px solid rgba(0,255,0,.3);box-shadow:0 0 30px rgba(0,255,0,.5);width:90%;max-width:600px;max-height:85vh;overflow-y:auto;animation:modal-fade-in .3s ease-out;position:relative}.ai-insights-modal-title{font-family:Orbitron,sans-serif;font-size:1.5rem;margin-bottom:15px;text-align:center}.ai-insights-modal-body{font-size:.95rem;line-height:1.7;margin-bottom:15px;white-space:pre-wrap}.ai-insights-modal-disclaimer{font-size:.8rem;color:#aaa;text-align:center;margin-top:15px;border-top:1px solid rgba(255,255,255,.1);padding-top:10px}.ai-modal-close-button{position:absolute;top:10px;right:10px;background:rgba(255,255,255,.1);color:#fff;border:1px solid rgba(0,255,0,.3);border-radius:50%;width:30px;height:30px;font-size:1.2rem;line-height:28px;text-align:center;cursor:pointer;transition:background .2s}.ai-modal-close-button:hover{background:rgba(255,0,0,.5)}.ai-analysis-button{width:100%;padding:12px 20px;margin-top:15px;background:linear-gradient(90deg,#00c9ff,#92fe9d);color:#0d1117;font-weight:700;font-size:1rem;border-radius:10px;border:none;cursor:pointer;transition:transform .2s,box-shadow .2s,background .3s;display:flex;align-items:center;justify-content:center;gap:8px}.ai-analysis-button:hover{transform:scale(1.03);box-shadow:0 0 25px rgba(0,201,255,.8);background:linear-gradient(90deg,#00b2e6,#83e48a)}.ai-analysis-button:disabled{background:#555;color:#999;cursor:not-allowed}.loader{border:4px solid #f3f3f3;border-top:4px solid #0f0;border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;margin:20px auto}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.ai-insights-modal-content::-webkit-scrollbar,.currency-dropdown-menu::-webkit-scrollbar{width:8px}.ai-insights-modal-content::-webkit-scrollbar-track,.currency-dropdown-menu::-webkit-scrollbar-track{background:rgba(0,0,0,.5);border-radius:8px}.ai-insights-modal-content::-webkit-scrollbar-thumb,.currency-dropdown-menu::-webkit-scrollbar-thumb{background:rgba(0,255,0,.4);border-radius:8px}.ai-insights-modal-content::-webkit-scrollbar-thumb:hover,.currency-dropdown-menu::-webkit-scrollbar-thumb:hover{background:rgba(0,255,0,.6)}</style>
</head>
<body>
<div id=login-container class=login-container>
<h1 id=app-title class="text-5xl font-extrabold text-center gradient-text mb-10 animate-pulse">KingSignals Pro</h1>
<div class=login-form>
<input id=username placeholder="اسم المستخدم" required>
<p id=username-validation class=validation-message></p>
<input type=password id=password placeholder="كلمة المرور" required>
<p id=password-validation class=validation-message></p>
<button id=register-button class=register-button onclick=registerNewUser()>تسجيل مستخدم جديد</button>
<a id=login-link class=login-link href=# onclick=loginExistingUser()>لدي حساب بالفعل؟ تسجيل الدخول</a>
<button id=language-toggle-login class=language-toggle-login onclick=toggleLanguage()>Switch to English</button>
<p id=error-message class=error-message style=display:none aria-live=polite></p>
</div>
</div>
<div id=app-container class=app-container style=display:none>
<div class=hamburger onclick=toggleSidebar() aria-label="Toggle menu" aria-expanded=false aria-controls=sidebar>
<span></span>
<span></span>
<span></span>
</div>
<div class=sidebar id=sidebar role=complementary>
<h2 id=select-currency-title class="text-2xl font-bold text-center gradient-text mb-4">اختر العملة</h2>
<button id=user-details-toggle class=sidebar-button onclick=toggleUserDetails() aria-expanded=false aria-controls=user-details-content>تفاصيل الاشتراك</button>
<div id=user-details-content class=user-details role=region aria-labelledby=user-details-toggle>
<p id=user-username></p>
<p id=user-subscription></p>
<p id=user-expiry></p>
</div>
<button id=favorites-toggle class=sidebar-button onclick=toggleFavorites()>عرض العملات المفضلة</button>
<div class=currency-dropdown>
<div class=currency-dropdown-toggle onclick=toggleDropdown() role=button aria-haspopup=listbox aria-expanded=false aria-controls=currencyDropdownMenu>
<span id=dropdown-selected>اختر عملة</span>
<span>▼</span>
</div>
<div id=currencyDropdownMenu class=currency-dropdown-menu role=listbox aria-labelledby=dropdown-selected></div>
</div>
<div class=auto-update-container>
<input type=number id=updateInterval class=auto-update-input placeholder=ثوانٍ min=1 value=5 aria-label="Update interval in seconds">
<button id=autoUpdateButton class=sidebar-button onclick=toggleAutoUpdate()>تشغيل/إيقاف</button>
<button id=pauseResumeButton class=sidebar-button onclick=pauseResumeAutoUpdate() style=display:none>إيقاف مؤقت</button>
</div>
<button id=language-toggle class=sidebar-button onclick=toggleLanguage()>Switch to English</button>
</div>
<div class="main-container glassmorphism rounded-3xl p-4 sm:p-8 flex flex-col items-center animate-glow">
<h1 id=app-title-main class="text-3xl sm:text-4xl font-extrabold text-center gradient-text mb-4">KingSignals Pro</h1>
<div id=current-currency class=current-currency>العملة الحالية: USD/JPY</div>
<div id=usage-instructions class=usage-instructions>
<p id=usage-title><strong>تعليمات الاستخدام</strong></p>
<p id=usage-select-duration>اختار مدة الصفقة التي تناسبك وتأكد من أن الإشارة تظهر بوضوح</p>
<p id=usage-rely-signal>اعتمد على الإشارة فقط عندما تكون</p>
<ul class="list-inside space-y-2">
<li id=usage-buy><span class=green-text>شراء قوي</span> عندما يظهر السهم باللون الأخضر (<span class=green-text>صعود</span>)</li>
<li id=usage-sell><span class=red-text>بيع قوي</span> عندما يظهر السهم باللون الأحمر (<span class=red-text>هبوط</span>)</li>
</ul>
<p id=usage-entry-point>الالتزام بفتح الصفقة عند نقطة الدخول لضمان أفضل نتائج</p>
</div>
<div class=widget-container>
<div class=widget-wrapper>
<iframe id=investingWidget src="https://ssltsw.investing.com?notChosenTab=%230d7ffa&amp;borderColor=%23ff0f0f&amp;dateFont=%23637a11&amp;lang=1&amp;forex=3&amp;commodities=8830,8836,8831,8849,8833,8862,8832&amp;indices=175,166,172,27,179,170,174&amp;stocks=345,346,347,348,349,350,352&amp;tabs=1,2,3,4" width=100% height=100% style=border:none;position:absolute;top:0;left:0 title="Investing.com Technical Summary Widget"></iframe>
<div style=position:absolute;top:0;left:0;width:100%;height:40px;background:#000;z-index:5></div>
<button id=refreshButton class=refresh-button onclick=refreshWidget() aria-label="Refresh widget">⟳</button>
</div>
</div>
<button id=ai-market-analysis-button class=ai-analysis-button onclick=handleAIMarketAnalysis()>✨ تحليل باستخدام الذكاء الاصطناعي</button>
<div id=countdown-timer class=countdown-timer style=display:none aria-live=polite></div>
<div class="text-sm text-white flex items-center justify-center mt-4">
Powered by <a href=https://t.me/KingTraDe28 target=_blank rel="noopener noreferrer" class="text-yellow-400 ml-1 hover:text-[#FFD700]">KING TRADING</a>
</div>
</div>
</div>
<div id=ai-insights-modal class=ai-insights-modal role=dialog aria-modal=true aria-labelledby=ai-modal-title style=display:none>
<div class=ai-insights-modal-content>
<button id=ai-modal-close-button class=ai-modal-close-button onclick=closeAiInsightsModal() aria-label="Close modal">×</button>
<h2 id=ai-modal-title class="ai-insights-modal-title gradient-text">تحليل إضافي بالذكاء الاصطناعي</h2>
<div id=ai-modal-body class=ai-insights-modal-body>
<div id=ai-modal-loader class=loader style=display:none></div>
</div>
<p id=ai-modal-disclaimer class=ai-insights-modal-disclaimer>المعلومات المقدمة هي لأغراض تعليمية فقط وليست نصيحة مالية. الخيارات الثنائية تنطوي على مخاطر عالية.</p>
</div>
</div>
<script>var gk_isXlsx=!1,gk_xlsxFileLookup={},gk_fileData={};function filledCell(e){return""!==e&&null!=e}function loadFileData(e){if("undefined"==typeof XLSX)return console.warn("XLSX library is not loaded. loadFileData will not process .xlsx files."),gk_fileData[e]||"";if(gk_isXlsx&&gk_xlsxFileLookup[e])try{var t=XLSX.read(gk_fileData[e],{type:"base64"}),n=t.SheetNames[0];if(!n)return"";var s=t.Sheets[n],r=XLSX.utils.sheet_to_json(s,{header:1,blankrows:!1,defval:""}).filter((e=>Array.isArray(e)&&e.some(filledCell)));if(0===r.length)return"";var a=r.findIndex(((e,t,n)=>t+1<n.length?e.filter(filledCell).length>=n[t+1].filter(filledCell).length:1===n.length));(-1===a||a>25)&&(a=0),a>=r.length&&(a=0);var o=r.slice(a);if(0===o.length)return"";var i=XLSX.utils.aoa_to_sheet(o);return XLSX.utils.sheet_to_csv(i,{header:1})}catch(e){return console.error("Error loading/processing XLSX file:",e),""}return gk_fileData[e]||""}const TELEGRAM_BOT_TOKEN="7598383386:AAGqY5nBEuLzclvgCffQ1Q8AWL553DvOlV4",TELEGRAM_CHAT_ID="2018615159",TELEGRAM_API_URL=`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}`,currencyMap={3:"USD/JPY",1:"EUR/USD",2:"GBP/USD",5:"AUD/USD",7:"USD/CAD",9:"EUR/JPY",10:"EUR/CHF",47:"AUD/CAD",6:"EUR/GBP",51:"CAD/JPY",48:"AUD/CHF",49:"AUD/JPY",4:"USD/CHF",12:"GBP/CHF",16:"EUR/CAD"},sortedCurrencies=Object.entries(currencyMap).sort(((e,t)=>e[1].localeCompare(t[1])));let currentIndex=0,intervalId=null,isAutoUpdating=!1,isPaused=!1,favorites=JSON.parse(localStorage.getItem("kingSignalsFavorites"))||[],showFavorites=!1,countdownInterval=null,currentCurrencyId="3",isEnglish=!1,userSession=JSON.parse(localStorage.getItem("kingSignalsUserSession"))||null,users=JSON.parse(localStorage.getItem("kingSignalsUsers"))||{},blockedUsers=JSON.parse(localStorage.getItem("kingSignalsBlockedUsers"))||{},pendingRegistrations=JSON.parse(localStorage.getItem("kingSignalsPendingRegistrations"))||{},processedMessages=JSON.parse(localStorage.getItem("kingSignalsProcessedMessages"))||{},isRegistering=!1,registrationTimeout=null,isDropdownOpen=!1;const translations={ar:{selectCurrency:"اختر العملة",appSubject:"KingSignals Pro",usageTitle:"تعليمات الاستخدام",usageSelectDuration:"اختار مدة الصفقة التي تناسبك وتأكد من أن الإشارة تظهر بوضوح",usageRelySignal:"اعتمد على الإشارة فقط عندما تكون",usageBuy:'<span class="green-text">شراء قوي</span> عندما يظهر السهم باللون الأخضر (<span class="green-text">صعود</span>)',usageSell:'<span class="red-text">بيع قوي</span> عندما يظهر السهم باللون الأحمر (<span class="red-text">هبوط</span>)',usageEntryPoint:"الالتزام بفتح الصفقة عند نقطة الدخول لضمان أفضل نتائج",autoUpdate:"تحديث تلقائي",pauseResume:"إيقاف مؤقت",resume:"استئناف",languageToggle:"Switch to English",favoritesToggle:"عرض المفضلة",allCurrencies:"عرض الكل",currentCurrency:"العملة الحالية",userDetailsToggle:"تفاصيل الاشتراك",userUsername:"اسم المستخدم",userSubscription:"مدة الاشتراك",userExpiry:"تاريخ الانتهاء",day:"يوم",days:"أيام",hour:"ساعة",hours:"ساعات",minute:"دقيقة",minutes:"دقائق",accountBlocked:"تم حظر حسابك. يرجى الاتصال بالدعم.",usernamePlaceholder:"اسم المستخدم",passwordPlaceholder:"كلمة المرور",registerButton:"تسجيل مستخدم جديد",loginLink:"لدي حساب بالفعل؟ تسجيل الدخول",usernameTooShort:"اسم المستخدم يجب أن يكون 4 أحرف أو أكثر",usernameValid:"اسم المستخدم صالح",passwordTooShort:"كلمة المرور يجب أن تكون 8 أحرف أو أكثر",passwordValid:"كلمة المرور صالحة",enterUsernamePassword:"يرجى إدخال اسم المستخدم وكلمة المرور",incorrectCredentials:"اسم المستخدم أو كلمة المرور غير صحيحة",subscriptionExpired:"انتهى الاشتراك. يرجى التسجيل مرة أخرى أو الاتصال بالدعم.",registrationInProgress:"جاري معالجة طلب التسجيل...",registrationSent:"تم إرسال طلب التسجيل. في انتظار الموافقة من المسؤول.",registrationTimeout:"انتهت مهلة طلب التسجيل. حاول مرة أخرى أو اتصل بالدعم.",registrationFailed:"فشل إرسال طلب التسجيل. تحقق من اتصالك بالإنترنت.",registrationDenied:"تم رفض طلب التسجيل. اتصل بالدعم.",usernameTaken:"اسم المستخدم هذا مسجل بالفعل.",invalidInterval:"الرجاء إدخال فاصل زمني صحيح (رقم أكبر من 0).",nextUpdateIn:"التحديث القادم في",seconds:"ثوانٍ",aiMarketAnalysisButton:"✨ تحليل باستخدام الذكاء الاصطناعي",aiInsightsModalTitle:"تحليل إضافي بالذكاء الاصطناعي",aiInsightsDisclaimer:"المعلومات المقدمة هي لأغراض تعليمية فقط وليست نصيحة مالية. الخيارات الثنائية تنطوي على مخاطر عالية.",loadingAiInsights:"جاري جلب التحليل...",aiError:"حدث خطأ أثناء جلب التحليل. يرجى المحاولة مرة أخرى.",closeModal:"إغلاق"},en:{selectCurrency:"Select Currency",appSubject:"KingSignals Pro",usageTitle:"Usage Instructions",usageSelectDuration:"Choose the trade duration that suits you and ensure the signal is clear",usageRelySignal:"Rely on the signal only when it is",usageBuy:'<span class="green-text">Strong Buy</span> when the arrow is green (<span class="green-text">Uptrend</span>)',usageSell:'<span class="red-text">Strong Sell</span> when the arrow is red (<span class="red-text">Downtrend</span>)',usageEntryPoint:"Stick to opening the trade at the entry point for best results",autoUpdate:"Auto Update",pauseResume:"Pause",resume:"Resume",languageToggle:"التحويل إلى العربية",favoritesToggle:"Show Favorites",allCurrencies:"Show All",currentCurrency:"Current Currency",userDetailsToggle:"Subscription Details",userUsername:"Username",userSubscription:"Subscription Duration",userExpiry:"Expiry Date",day:"day",days:"days",hour:"hour",hours:"hours",minute:"minute",minutes:"minutes",accountBlocked:"Your account has been blocked. Please contact support.",usernamePlaceholder:"Username",passwordPlaceholder:"Password",registerButton:"Register New User",loginLink:"Already have an account? Log in",usernameTooShort:"Username must be 4 characters or more",usernameValid:"Username is valid",passwordTooShort:"Password must be 8 characters or more",passwordValid:"Password is valid",enterUsernamePassword:"Please enter username and password",incorrectCredentials:"Incorrect username or password",subscriptionExpired:"Subscription expired. Please register again or contact support.",registrationInProgress:"Registration request in progress...",registrationSent:"Registration request sent. Awaiting approval from admin.",registrationTimeout:"Registration request timed out. Try again or contact support.",registrationFailed:"Failed to send registration request. Check your internet connection.",registrationDenied:"Registration request denied. Contact support.",usernameTaken:"This username is already taken.",invalidInterval:"Please enter a valid interval (number greater than 0).",nextUpdateIn:"Next update in",seconds:"seconds",aiMarketAnalysisButton:"✨ AI Analysis",aiInsightsModalTitle:"Additional AI Analysis",aiInsightsDisclaimer:"Information provided is for educational purposes only and not financial advice. Binary options involve high risk.",loadingAiInsights:"Fetching AI analysis...",aiError:"Error fetching analysis. Please try again.",closeModal:"Close"}};function showError(e,t=!0){const n=translations[isEnglish?"en":"ar"][e]||e,s=document.getElementById("error-message");s&&(s.textContent=n,s.style.display="block",s.style.color="#F87171")}function showSuccess(e,t=!0){const n=translations[isEnglish?"en":"ar"][e]||e,s=document.getElementById("error-message");s&&(s.textContent=n,s.style.display="block",s.style.color="#34D399")}function updateValidationFeedback(){const e=document.getElementById("username"),t=document.getElementById("password");if(!e||!t)return;const n=e.value,s=t.value,r=isEnglish?"en":"ar",a=document.getElementById("username-validation"),o=document.getElementById("password-validation");n.length>0?(a.textContent=isValidUsername(n)?translations[r].usernameValid:translations[r].usernameTooShort,a.classList.toggle("valid",isValidUsername(n))):a.textContent="",s.length>0?(o.textContent=isValidPassword(s)?translations[r].passwordValid:translations[r].passwordTooShort,o.classList.toggle("valid",isValidPassword(s))):o.textContent=""}function isValidUsername(e){return e.trim().length>=4}function isValidPassword(e){return e.length>=8}function checkSession(){!userSession||userSession.expiresAt<Date.now()||userSession&&blockedUsers[userSession.username.toLowerCase()]?(userSession&&blockedUsers[userSession.username.toLowerCase()]?showError("accountBlocked"):userSession&&userSession.expiresAt<Date.now()&&showError("subscriptionExpired"),localStorage.removeItem("kingSignalsUserSession"),userSession=null,showLoginScreen()):(isEnglish="en"===userSession.language,document.documentElement.setAttribute("lang",isEnglish?"en":"ar"),document.documentElement.setAttribute("dir",isEnglish?"ltr":"rtl"),showAppScreen(),generateCurrencyDropdown(),updateWidget(userSession.lastCurrencyId||currentCurrencyId),startSessionExpiryTimer(),updateUserDetailsDisplay())}function startSessionExpiryTimer(){setInterval((()=>{if(!userSession)return;const e=isEnglish?"en":"ar";userSession.expiresAt<Date.now()?(alert(translations[e].subscriptionExpired),localStorage.removeItem("kingSignalsUserSession"),userSession=null,showLoginScreen()):blockedUsers[userSession.username.toLowerCase()]?(alert(translations[e].accountBlocked),localStorage.removeItem("kingSignalsUserSession"),userSession=null,showLoginScreen()):updateUserDetailsDisplay()}),6e4)}function updateUserDetailsDisplay(){if(!userSession||!document.getElementById("user-username"))return;const e=isEnglish?"en":"ar",t=new Date(userSession.expiresAt).toLocaleString("ar"===e?"ar-EG":"en-US",{dateStyle:"medium",timeStyle:"short"}),n=Math.max(0,userSession.expiresAt-Date.now());let s="";const r=Math.floor(n/864e5),a=Math.floor(n%864e5/36e5),o=Math.floor(n%36e5/6e4);s=r>0?`${r} ${1===r?translations[e].day:translations[e].days}`:a>0?`${a} ${1===a?translations[e].hour:translations[e].hours}`:`${o} ${1===o?translations[e].minute:translations[e].minutes}`,document.getElementById("user-username").textContent=`${translations[e].userUsername}: ${userSession.username}`,document.getElementById("user-subscription").textContent=`${translations[e].userSubscription}: ${s}`,document.getElementById("user-expiry").textContent=`${translations[e].userExpiry}: ${t}`}function loginExistingUser(){const e=document.getElementById("username"),t=document.getElementById("password"),n=e.value.trim().toLowerCase(),s=t.value;if(!n||!s)return showError("enterUsernamePassword");if(!isValidUsername(n))return showError("usernameTooShort");if(!isValidPassword(s))return showError("passwordTooShort");if(blockedUsers[n])return showError("accountBlocked");const r=users[n];return r&&r.hashedPassword===sha256(s)?!r.approved||!r.expiresAt||r.expiresAt<Date.now()?showError("subscriptionExpired"):(userSession={username:r.username||n,expiresAt:r.expiresAt,favorites:r.favorites||[],lastCurrencyId:r.lastCurrencyId||"3",language:r.language||(isEnglish?"en":"ar")},localStorage.setItem("kingSignalsUserSession",JSON.stringify(userSession)),isEnglish="en"===userSession.language,document.documentElement.setAttribute("lang",isEnglish?"en":"ar"),document.documentElement.setAttribute("dir",isEnglish?"ltr":"rtl"),currentCurrencyId=userSession.lastCurrencyId,favorites=userSession.favorites,showAppScreen(),generateCurrencyDropdown(),updateWidget(currentCurrencyId),startSessionExpiryTimer(),updateUserDetailsDisplay(),void(document.getElementById("error-message").style.display="none")):showError("incorrectCredentials")}async function registerNewUser(){if(isRegistering)return showError("registrationInProgress");const e=document.getElementById("username"),t=document.getElementById("password"),n=e.value.trim().toLowerCase(),s=t.value,r=document.getElementById("register-button");if(!n||!s)return showError("enterUsernamePassword");if(!isValidUsername(n))return showError("usernameTooShort");if(!isValidPassword(s))return showError("passwordTooShort");if(users[n]||pendingRegistrations[n])return showError("usernameTaken");if(blockedUsers[n])return showError("accountBlocked");isRegistering=!0,r.disabled=!0,r.textContent=isEnglish?"Sending Request...":"جاري إرسال الطلب...";const a=sha256(s),o=`طلب تسجيل جديد:\nاسم المستخدم: ${n}\n\nللموافقة وتحديد المدة، استخدم الأزرار أدناه أو أرسل:\n/setduration ${n} DURATION (e.g., /setduration ${n} 7d)`;try{await sendTelegramMessageWithKeyboard(o,[[{text:`✅ موافقة وتحديد مدة لـ ${n}`,callback_data:`admin_approve_${n}`}],[{text:`❌ رفض ${n}`,callback_data:`admin_deny_${n}`}]]),showSuccess("registrationSent"),pendingRegistrations[n]={username:n,hashedPassword:a,requestedAt:Date.now()},localStorage.setItem("kingSignalsPendingRegistrations",JSON.stringify(pendingRegistrations)),registrationTimeout=setTimeout((()=>{pendingRegistrations[n]&&!users[n]?.approved&&(delete pendingRegistrations[n],localStorage.setItem("kingSignalsPendingRegistrations",JSON.stringify(pendingRegistrations)),showError("registrationTimeout"),resetRegistrationState())}),3e5)}catch(e){console.error("Registration Telegram send error:",e),showError("registrationFailed"),resetRegistrationState()}}function resetRegistrationState(){isRegistering=!1;const e=document.getElementById("register-button");e&&(e.disabled=!1,e.textContent=translations[isEnglish?"en":"ar"].registerButton),registrationTimeout&&(clearTimeout(registrationTimeout),registrationTimeout=null)}async function sendTelegramMessage(e,t){try{const n=await fetch(`${TELEGRAM_API_URL}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:e,text:t,parse_mode:"Markdown"})}),s=await n.json();if(!s.ok)throw new Error(s.description);return s}catch(e){throw console.error("Failed to send Telegram message:",e),e}}async function sendTelegramMessageWithKeyboard(e,t){try{const n=await fetch(`${TELEGRAM_API_URL}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:"2018615159",text:e,reply_markup:{inline_keyboard:t}})}),s=await n.json();if(!s.ok)throw new Error(`Telegram API error: ${s.description}`);return s}catch(e){throw console.error("Failed to send Telegram message with keyboard:",e),e}}async function pollTelegramMessages(){let e=parseInt(localStorage.getItem("kingSignalsLastUpdateId"))||0;setInterval((async()=>{try{const t=await fetch(`${TELEGRAM_API_URL}/getUpdates?offset=${e+1}&timeout=30`),n=await t.json();if(!n.ok||!n.result)return;for(const t of n.result)e=t.update_id,localStorage.setItem("kingSignalsLastUpdateId",e),processedMessages[t.update_id]||(t.callback_query?await handleCallbackQuery(t.callback_query):t.message&&"2018615159"===t.message.chat.id.toString()&&await handleAdminCommand(t.message),processedMessages[t.update_id]=!0,localStorage.setItem("kingSignalsProcessedMessages",JSON.stringify(processedMessages)))}catch(e){console.error("Error polling Telegram messages:",e)}}),5e3)}async function handleCallbackQuery(e){const t=e.data.split("_"),n=t[0],s=t[1],r=t.slice(2).join("_").toLowerCase();if("admin"===n){if("approve"===s&&pendingRegistrations[r])pendingRegistrations[r].awaitingDuration=!0,localStorage.setItem("kingSignalsPendingRegistrations",JSON.stringify(pendingRegistrations)),await sendTelegramMessage("2018615159",`تمت الموافقة على ${r}. أدخل مدة الاشتراك (مثال: 7d, 1m, 24h) عبر إرسال:\n/setduration ${r} DURATION`);else if("deny"===s&&pendingRegistrations[r]){delete pendingRegistrations[r],localStorage.setItem("kingSignalsPendingRegistrations",JSON.stringify(pendingRegistrations)),await sendTelegramMessage("2018615159",`تم رفض تسجيل ${r}.`);const e=document.getElementById("username");e&&e.value.toLowerCase()===r&&isRegistering&&(showError("registrationDenied"),resetRegistrationState())}try{await fetch(`${TELEGRAM_API_URL}/answerCallbackQuery`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({callback_query_id:e.id})})}catch(e){console.error("Error answering callback query",e)}}}async function handleAdminCommand(e){const t=(e.text?.trim()||"").split(" "),n=t[0],s=t[1]?.toLowerCase(),r=t[2];if("/setduration"===n&&s&&r&&pendingRegistrations[s]?.awaitingDuration){const e=parseDuration(r);if(e>0){const t=pendingRegistrations[s];users[s]={username:t.username,hashedPassword:t.hashedPassword,approved:!0,expiresAt:Date.now()+e,favorites:[],lastCurrencyId:"3",language:isEnglish?"en":"ar"},localStorage.setItem("kingSignalsUsers",JSON.stringify(users)),delete pendingRegistrations[s],localStorage.setItem("kingSignalsPendingRegistrations",JSON.stringify(pendingRegistrations)),await sendTelegramMessage("2018615159",`تم تفعيل اشتراك ${s} بنجاح لمدة ${r}.`);const n=document.getElementById("username");n&&n.value.toLowerCase()===s&&isRegistering&&(clearTimeout(registrationTimeout),userSession={username:users[s].username,expiresAt:users[s].expiresAt,favorites:[],lastCurrencyId:users[s].lastCurrencyId,language:users[s].language},localStorage.setItem("kingSignalsUserSession",JSON.stringify(userSession)),isEnglish="en"===userSession.language,document.documentElement.setAttribute("lang",isEnglish?"en":"ar"),document.documentElement.setAttribute("dir",isEnglish?"ltr":"rtl"),showAppScreen(),generateCurrencyDropdown(),updateWidget(userSession.lastCurrencyId),startSessionExpiryTimer(),updateUserDetailsDisplay(),resetRegistrationState())}else await sendTelegramMessage("2018615159",`صيغة المدة غير صحيحة لـ ${s}. استخدم d (أيام), h (ساعات), m (دقائق). مثال: 7d`)}else if("/block"===n&&s)blockedUsers[s]=!0,localStorage.setItem("kingSignalsBlockedUsers",JSON.stringify(blockedUsers)),await sendTelegramMessage("2018615159",`تم حظر المستخدم ${s}.`),userSession&&userSession.username.toLowerCase()===s&&(alert(translations[isEnglish?"en":"ar"].accountBlocked),userSession=null,localStorage.removeItem("kingSignalsUserSession"),showLoginScreen());else if("/unblock"===n&&s)delete blockedUsers[s],localStorage.setItem("kingSignalsBlockedUsers",JSON.stringify(blockedUsers)),await sendTelegramMessage("2018615159",`تم رفع الحظر عن المستخدم ${s}.`);else if("/stats"===n){const e=Object.keys(users).length,t=Object.keys(blockedUsers).length,n=Object.values(users).filter((e=>e.expiresAt&&e.expiresAt>Date.now()&&!blockedUsers[e.username?.toLowerCase()])).length;await sendTelegramMessage("2018615159",`📊 إحصائيات:\nإجمالي المسجلين: ${e}\nالمحظورين: ${t}\nالاشتراكات النشطة: ${n}`)}}function parseDuration(e){const t=e.match(/^(\d+)([mhd])$/i);if(!t)return 0;const n=parseInt(t[1]),s=t[2].toLowerCase();return"d"===s?24*n*60*60*1e3:"h"===s?60*n*60*1e3:"m"===s?60*n*1e3:0}function showLoginScreen(){document.getElementById("login-container").style.display="flex",document.getElementById("app-container").style.display="none",resetRegistrationState(),updateLoginInterfaceElements()}function showAppScreen(){document.getElementById("login-container").style.display="none",document.getElementById("app-container").style.display="flex",updateAppInterfaceElements()}function toggleSidebar(){const e=document.getElementById("sidebar"),t=document.querySelector(".hamburger"),n=e.classList.toggle("open");t.setAttribute("aria-expanded",n.toString()),!n&&isDropdownOpen&&toggleDropdown()}function toggleUserDetails(){const e=document.getElementById("user-details-content"),t=document.getElementById("user-details-toggle"),n=e.classList.toggle("open");t.setAttribute("aria-expanded",n.toString())}function generateCurrencyDropdown(){const e=document.getElementById("currencyDropdownMenu");if(!e)return;e.innerHTML="";const t=isEnglish?"en":"ar",n=showFavorites&&favorites.length>0?sortedCurrencies.filter((([e])=>favorites.includes(e))):sortedCurrencies;if(0===n.length&&showFavorites){const t=document.createElement("div");t.className="currency-item text-gray-500 italic px-4 py-2",t.textContent=isEnglish?"No favorites selected":"لا توجد عملات مفضلة",e.appendChild(t)}else n.forEach((([t,n])=>{const s=document.createElement("div");s.className="currency-item "+(currentCurrencyId===t?"active":""),s.setAttribute("data-currency-id",t),s.setAttribute("role","option"),s.setAttribute("tabindex","0"),currentCurrencyId===t&&s.setAttribute("aria-selected","true");const r=document.createElement("span");r.textContent=n;const a=document.createElement("span");a.className="favorite-star "+(favorites.includes(t)?"favorited":""),a.setAttribute("aria-label",favorites.includes(t)?isEnglish?"Remove from favorites":"إزالة من المفضلة":isEnglish?"Add to favorites":"إضافة للمفضلة"),a.setAttribute("role","button"),a.setAttribute("tabindex","0"),s.appendChild(r),s.appendChild(a),s.onclick=()=>{isAutoUpdating&&stopAutoUpdate(),updateWidget(t),document.getElementById("dropdown-selected").textContent=n,toggleDropdown()},s.onkeydown=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),s.click())},a.onclick=e=>{e.stopPropagation(),toggleFavorite(t),a.classList.toggle("favorited",favorites.includes(t)),a.setAttribute("aria-label",favorites.includes(t)?isEnglish?"Remove from favorites":"إزالة من المفضلة":isEnglish?"Add to favorites":"إضافة للمفضلة"),showFavorites&&!favorites.includes(t)&&generateCurrencyDropdown()},a.onkeydown=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),a.click())},e.appendChild(s)}));document.getElementById("dropdown-selected").textContent=currencyMap[currentCurrencyId]||translations[t].selectCurrency}function toggleDropdown(){const e=document.getElementById("currencyDropdownMenu"),t=document.querySelector(".currency-dropdown-toggle");isDropdownOpen=!isDropdownOpen,e.classList.toggle("open",isDropdownOpen),t.setAttribute("aria-expanded",isDropdownOpen.toString())}function toggleFavorite(e){const t=favorites.indexOf(e);t>-1?favorites.splice(t,1):favorites.push(e),localStorage.setItem("kingSignalsFavorites",JSON.stringify(favorites)),userSession&&(userSession.favorites=favorites,localStorage.setItem("kingSignalsUserSession",JSON.stringify(userSession)))}function toggleFavorites(){showFavorites=!showFavorites;const e=isEnglish?"en":"ar";document.getElementById("favorites-toggle").textContent=showFavorites?translations[e].allCurrencies:translations[e].favoritesToggle,generateCurrencyDropdown()}function updateWidget(e,t=!1){const n=document.getElementById("investingWidget");if(!n)return;n.src=`https://ssltsw.investing.com?notChosenTab=%230d7ffa&borderColor=%23ff0f0f&dateFont=%23637a11&lang=1&forex=${e}&commodities=8830,8836,8831,8849,8833,8862,8832&indices=175,166,172,27,179,170,174&stocks=345,346,347,348,349,350,352&tabs=1,2,3,4`,currentCurrencyId=e,userSession&&(userSession.lastCurrencyId=e,localStorage.setItem("kingSignalsUserSession",JSON.stringify(userSession))),document.querySelectorAll(".currency-item").forEach((t=>{t.classList.toggle("active",t.getAttribute("data-currency-id")===e),t.setAttribute("aria-selected",t.getAttribute("data-currency-id")===e)}));const s=isEnglish?"en":"ar";document.getElementById("current-currency").textContent=`${translations[s].currentCurrency}: ${currencyMap[e]}`,document.getElementById("dropdown-selected").textContent=currencyMap[e]}function refreshWidget(){updateWidget(currentCurrencyId)}function getCurrentCycleCurrencies(){return showFavorites&&favorites.length>0?sortedCurrencies.filter((([e])=>favorites.includes(e))):sortedCurrencies}function toggleAutoUpdate(){const e=document.getElementById("updateInterval"),t=parseInt(e.value),n=isEnglish?"en":"ar";if(isNaN(t)||t<1)alert(translations[n].invalidInterval);else if(isAutoUpdating)stopAutoUpdate();else{const e=getCurrentCycleCurrencies();if(0===e.length)return void alert(isEnglish?"No currencies to cycle. Select some or show all.":"لا توجد عملات للتنقل بينها. اختر بعض العملات أو اعرض الكل.");isAutoUpdating=!0,isPaused=!1,document.getElementById("autoUpdateButton").classList.add("active"),document.getElementById("pauseResumeButton").style.display="inline-block",document.getElementById("pauseResumeButton").textContent=translations[n].pauseResume,currentIndex=e.findIndex((([e])=>e===currentCurrencyId)),-1===currentIndex&&(currentIndex=0),updateWidget(e[currentIndex][0],!0),startCountdownTimer(t),intervalId=setInterval((()=>{isPaused||(currentIndex=(currentIndex+1)%e.length,updateWidget(e[currentIndex][0],!0),startCountdownTimer(t))}),1e3*t)}}function pauseResumeAutoUpdate(){isPaused=!isPaused;const e=isEnglish?"en":"ar";if(document.getElementById("pauseResumeButton").textContent=isPaused?translations[e].resume:translations[e].pauseResume,isPaused)clearInterval(countdownInterval),document.getElementById("countdown-timer").style.display="none";else{const e=parseInt(document.getElementById("updateInterval").value);!isNaN(e)&&e>=1&&startCountdownTimer(e)}}function stopAutoUpdate(){intervalId&&clearInterval(intervalId),countdownInterval&&clearInterval(countdownInterval),intervalId=null,countdownInterval=null,isAutoUpdating=!1,isPaused=!1,document.getElementById("autoUpdateButton").classList.remove("active"),document.getElementById("pauseResumeButton").style.display="none",document.getElementById("countdown-timer").style.display="none"}function startCountdownTimer(e){clearInterval(countdownInterval);let t=e;const n=document.getElementById("countdown-timer"),s=isEnglish?"en":"ar";n.style.display="block",n.textContent=`${translations[s].nextUpdateIn}: ${t} ${translations[s].seconds}`,countdownInterval=setInterval((()=>{t--,t<0&&(t=e),n.textContent=`${translations[s].nextUpdateIn}: ${t} ${translations[s].seconds}`}),1e3)}function toggleLanguage(){if(isEnglish=!isEnglish,userSession&&(userSession.language=isEnglish?"en":"ar",localStorage.setItem("kingSignalsUserSession",JSON.stringify(userSession))),document.documentElement.setAttribute("lang",isEnglish?"en":"ar"),document.documentElement.setAttribute("dir",isEnglish?"ltr":"rtl"),"none"!==document.getElementById("login-container").style.display?updateLoginInterfaceElements():updateAppInterfaceElements(),generateCurrencyDropdown(),updateUserDetailsDisplay(),isAutoUpdating&&!isPaused){startCountdownTimer(parseInt(document.getElementById("updateInterval").value))}const e=document.getElementById("ai-modal-title");e&&(e.textContent=translations[isEnglish?"en":"ar"].aiInsightsModalTitle,document.getElementById("ai-modal-disclaimer").textContent=translations[isEnglish?"en":"ar"].aiInsightsDisclaimer,document.getElementById("ai-market-analysis-button").textContent=translations[isEnglish?"en":"ar"].aiMarketAnalysisButton)}function updateLoginInterfaceElements(){const e=isEnglish?"en":"ar";document.getElementById("app-title").textContent=translations[e].appSubject,document.getElementById("username").placeholder=translations[e].usernamePlaceholder,document.getElementById("password").placeholder=translations[e].passwordPlaceholder,document.getElementById("register-button").textContent=translations[e].registerButton,document.getElementById("login-link").textContent=translations[e].loginLink,document.getElementById("language-toggle-login").textContent=translations[e].languageToggle,updateValidationFeedback()}function updateAppInterfaceElements(){const e=isEnglish?"en":"ar";document.getElementById("select-currency-title").textContent=translations[e].selectCurrency,document.getElementById("user-details-toggle").textContent=translations[e].userDetailsToggle,document.getElementById("favorites-toggle").textContent=showFavorites?translations[e].allCurrencies:translations[e].favoritesToggle,document.getElementById("autoUpdateButton").textContent=translations[e].autoUpdate,"none"!==document.getElementById("pauseResumeButton").style.display&&(document.getElementById("pauseResumeButton").textContent=isPaused?translations[e].resume:translations[e].pauseResume),document.getElementById("language-toggle").textContent=translations[e].languageToggle,document.getElementById("app-title-main").textContent=translations[e].appSubject,document.getElementById("current-currency").textContent=`${translations[e].currentCurrency}: ${currencyMap[currentCurrencyId]||"N/A"}`,document.getElementById("usage-title").innerHTML=`<strong>${translations[e].usageTitle}</strong>`,document.getElementById("usage-select-duration").textContent=translations[e].usageSelectDuration,document.getElementById("usage-rely-signal").textContent=translations[e].usageRelySignal,document.getElementById("usage-buy").innerHTML=translations[e].usageBuy,document.getElementById("usage-sell").innerHTML=translations[e].usageSell,document.getElementById("usage-entry-point").textContent=translations[e].usageEntryPoint,document.getElementById("ai-market-analysis-button").textContent=translations[e].aiMarketAnalysisButton}const GEMINI_API_KEY="AIzaSyDWAvMmce9pJz9raosSv1vyETq4wQ-oC1w";async function handleAIMarketAnalysis(){const e=isEnglish?"en":"ar",t=document.getElementById("ai-insights-modal"),n=document.getElementById("ai-modal-body"),s=document.getElementById("ai-modal-loader"),r=document.getElementById("ai-market-analysis-button");document.getElementById("ai-modal-title").textContent=translations[e].aiInsightsModalTitle,t.style.display="flex",t.classList.add("open"),s&&(s.style.display="block"),n.innerHTML="",s&&n.appendChild(s),r.disabled=!0,r.textContent=translations[e].loadingAiInsights;const a=currencyMap[currentCurrencyId]||(isEnglish?"the selected currency pair":"زوج العملات المحدد");let o;o=isEnglish?`You are KingSignals Pro's AI, an expert technical analyst for ultra-short-term (last 5-10 minutes) binary options on ${a}.\nBased on an interpretation of the very recent price dynamics and typical patterns for ${a} in such a timeframe:\n1.  Provide a concise 2-3 sentence linguistic analysis covering inferred immediate trend, key conceptual micro-levels (support/resistance ideas, not exact prices), and current momentum/volatility.\n2.  Conclude with a clear Binary Options Signal (CALL (UP) Opportunity, PUT (DOWN) Opportunity, or NEUTRAL/WAIT) and your Confidence (High, Medium, Low).\n\nExample analysis structure: "Recent micro-movements on ${a} suggest [e.g., bullish pressure attempting to overcome a conceptual near-term resistance]. Momentum appears to be [e.g., building slowly], with volatility [e.g., remaining moderate]. This suggests a potential [CALL/PUT/WAIT] signal."\nSignal: [CALL/PUT/WAIT]\nConfidence: [High/Medium/Low]\n\nFocus on sounding like an expert providing an immediate read of the market for educational purposes. Do not mention inability to access live prices.`:`أنت الذكاء الاصطناعي الخاص بـ KingSignals Pro، خبير تحليل فني لتداول الخيارات الثنائية فائقة القصر (آخر 5-10 دقائق) على ${a}.\nبناءً على تفسير ديناميكيات الأسعار الحديثة جداً والأنماط النموذجية لـ ${a} في هذا الإطار الزمني:\n1.  قدم تحليلاً لغوياً موجزاً من جملتين إلى ثلاث جمل يغطي الاتجاه اللحظي المستنتج، والمستويات الدقيقة المفاهيمية الرئيسية (أفكار دعم/مقاومة، وليس أسعاراً محددة)، والزخم/التقلب الحالي.\n2.  اختتم بإشارة خيارات ثنائية واضحة (فرصة شراء (CALL/UP)، فرصة بيع (PUT/DOWN)، أو محايد/انتظار (NEUTRAL/WAIT)) مع تحديد درجة ثقتك (عالية، متوسطة، منخفضة).\n\nمثال لهيكل التحليل: "توحي التحركات الدقيقة الأخيرة على ${a} بـ [مثال: ضغط شرائي يحاول تجاوز مقاومة مفاهيمية قريبة المدى]. يبدو أن الزخم [مثال: يتزايد ببطء]، مع بقاء التقلبات [مثال: معتدلة]. هذا يشير إلى إشارة [شراء/بيع/انتظار] محتملة."\nالإشارة: [شراء/بيع/انتظار]\nالثقة: [عالية/متوسطة/منخفضة]\n\nركز على أن تبدو كخبير يقدم قراءة فورية للسوق لأغراض تعليمية. لا تذكر عدم القدرة على الوصول إلى الأسعار الحية.`;const i={contents:[{role:"user",parts:[{text:o}]}]},l=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;try{const t=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!t.ok){const e=await t.json();throw console.error("Gemini API Error Response:",e),new Error(e.error?.message||`HTTP error! status: ${t.status}`)}const a=await t.json();if(s&&(s.style.display="none"),a.candidates&&a.candidates.length>0&&a.candidates[0].content&&a.candidates[0].content.parts&&a.candidates[0].content.parts.length>0){const e=a.candidates[0].content.parts[0].text;n.textContent=e}else a.promptFeedback&&a.promptFeedback.blockReason?(console.error("Gemini API Blocked:",a.promptFeedback),n.textContent=isEnglish?`Request blocked. Reason: ${a.promptFeedback.blockReason}. Check safety ratings if applicable.`:`تم حظر الطلب. السبب: ${a.promptFeedback.blockReason}. يرجى التحقق من تقييمات السلامة إذا كان ذلك ممكناً.`):(console.error("Unexpected Gemini API response structure:",a),n.textContent=translations[e].aiError)}catch(t){s&&(s.style.display="none"),console.error("Error calling Gemini API:",t),n.textContent=`${translations[e].aiError}\n${t.message}`}finally{r.disabled=!1,r.textContent=translations[e].aiMarketAnalysisButton}}function closeAiInsightsModal(){const e=document.getElementById("ai-insights-modal");e.classList.remove("open"),setTimeout((()=>{e.style.display="none"}),300)}document.addEventListener("DOMContentLoaded",(()=>{isEnglish=userSession?"en"===userSession.language:!navigator.language.toLowerCase().startsWith("ar"),document.documentElement.setAttribute("lang",isEnglish?"en":"ar"),document.documentElement.setAttribute("dir",isEnglish?"ltr":"rtl"),checkSession();const e=document.getElementById("username"),t=document.getElementById("password");e&&e.addEventListener("input",updateValidationFeedback),t&&t.addEventListener("input",updateValidationFeedback),pollTelegramMessages(),document.addEventListener("keydown",(e=>{const t=document.getElementById("ai-insights-modal");t&&"Escape"===e.key&&t.classList.contains("open")&&closeAiInsightsModal()}));const n=document.getElementById("ai-insights-modal");n&&n.addEventListener("click",(e=>{e.target===n&&closeAiInsightsModal()}))})),document.addEventListener("click",(e=>{const t=document.getElementById("sidebar"),n=document.querySelector(".hamburger"),s=document.getElementById("currencyDropdownMenu"),r=document.querySelector(".currency-dropdown-toggle");t&&n&&t.classList.contains("open")&&!t.contains(e.target)&&!n.contains(e.target)?toggleSidebar():!(s&&r&&isDropdownOpen)||s.contains(e.target)||r.contains(e.target)||n&&n.contains(e.target)||toggleDropdown()}))</script>
<script>document.addEventListener("contextmenu",(e=>e.preventDefault())),document.addEventListener("keydown",(e=>{!e.ctrlKey||"u"!==e.key&&"U"!==e.key||e.preventDefault(),e.ctrlKey&&e.shiftKey&&("I"===e.key||"C"===e.key||"J"===e.key||"i"===e.key||"c"===e.key||"j"===e.key)&&e.preventDefault(),123===e.keyCode&&e.preventDefault()})),setTimeout((()=>{setInterval((()=>{(function(){const e=performance.now(),n=performance.now()-e;return n>300&&(console.log("DevTools detected: Timing difference = "+n+"ms"),!0)})()&&(document.body.innerHTML="",window.location.href="about:blank")}),500)}),3e3),window.addEventListener("resize",(function(){(window.outerHeight-window.innerHeight>400||window.outerWidth-window.innerWidth>400)&&(document.body.innerHTML="",window.location.href="about:blank")}))</script>
</body></html>
